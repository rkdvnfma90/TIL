# 쿠키와 세션, 웹 스토리지

<br>

쿠키와 세션에 대해 알아보기 전에 HTTP 통신에 대해 간단히 짚고 넘어가자.

HTTP 통신은 다음과 같은 특징이 있다.
- HTTP Request는 상태가 존재하지 않는다.
- 상태가 없기 때문에 서버는 어떤 브라우저에서 요청이 온것인지 알 수 없다.
- 이 때 헤더에 `쿠키`를 담으면 서버가 쿠키를 읽어 어디서 온것인지 알 수 있다.

<br>

## 쿠키

<br>

- 쿠키는 클라이언트에서 저장하고 관리한다.
- 브라우저를 닫아도 유지된다.
- 서버에서 `Set-cookie`를 응답 헤더로 주면 클라이언트는 받아서 저장한다.
- 클라이언트에서 자체적으로 조작할 수 있다. 
- 각 쿠키의 수명을 지정할 수 있다.

서버에서 응답 헤더로 보내주는 `Set-cookie`는 `키=값`의 형태로 내려온다.

쿠키는 여러 옵션을 가질 수 있는데 그 옵션들은 아래와 같다.

- Expires : 쿠키의 만료일 설정
- Secure : HTTPS에서만 쿠키를 전송한다. 
- HttpOnly : 자바스크립트에서 쿠키에 접근 못하도록 하는 옵션 (XSS 방지)
- Max-Age : 쿠키의 수명을 지정하는데, 이 때 Expires는 무시한다.
- Domain : 도메인이 일치하는 요청만 쿠키가 전송된다.
- Path : 패스가 일치하는 요청만 쿠키가 전송된다.

<br>

### 쿠키의 취약점

<br>

- XSS 공격을 당할 수 있다.
    - Javascript를 사용하여 악의적인 사용자가 다른 사용자의 쿠키를 탈취할 수 있음
    - 쿠키를 암호화 하지 않았을 경우 중간에 탈취당할 수 있다.

<br>

## 세션

<br>

아무리 브라우저에서 쿠키를 보내도 서버에서는 그 쿠키의 주인이 누구인지 정확하게 알 수 없다. 이것을 해결하기 위한것이 바로 `세션`이다.

쿠키의 `HTTP Session Id`를 식별자로 사용하여 사용자를 구분한다. 그래서 클라이언트에서 `HTTP Session Id`를 쿠키 형태로 저장한다.

<br>

### 세션의 문제점

<br>

세션에는 큰 문제점이 있어 최근에는 인증용으로 잘 사용하지 않는다고 한다. 그 문제점 중 하나는 `세션이 서버에 파일로 저장`되기 때문에 사용자가 많아져서 저장공간이 부족해져 동작하지 않을 수 있다. 또한 서버가 2개 이상일 경우 인증 정보가 퍼져있기 때문에 제대로된 값을 응답하지 못할 수 있다.

그렇기 때문에 요즘은 `jwt`토큰을 사용하고, 쿠키는 단지 클라이언트의 지속적인 데이터관리 용도로 사용한다.

<br>

## 웹 스토리지의 등장

<br>

`웹 스토리지`는 쿠키대신 로컬데이터를 관리한다. HTML5 부터 등장하였고 쿠키가 하기 힘든것들을 지원하기 위해 등장하였다. 웹 스토리지는 크게 `로컬 스토리지`와 `세션 스토리지`로 나누어져 있는데 이것에 대해 알아보자.

<br>


- 로컬 스토리지의 특징
    - 로컬 스토리지에 데이터를 저장하면 반영구적으로 데이터가 저장된다
    - 그렇기 때문에 브라우저를 종료해도 데이터가 유지된다
    - 하지만 같은 도메인 내에서만 사용이 가능하다 (도메인 별 데이터가 분리되어있음)
    - key-value 형태로 저장된다

    <br>

- 세션 스토리지의 특징
    - 브라우저의 새 창을 생성할 때 마다 개별적으로 저장되는 데이터를 관리한다
    - 브라우저를 닫는 순간 사라진다
    - 도메인이 동일해도 세션이 다르면 접근할 수 없다
    - key-value 형태로 저장된다

    <br>

그럼 이 두개가 쿠키보다 더 편한점은 무엇일까? 바로 사용 편의성 이라고 할 수 있다. 쿠키의 경우 관리를 String으로 하기 때문에 별도의 파싱로직이 필요해서 번거로울 수 있는 반면, 로컬,세션 스토리지는 `getItem, setItem, removeItem, clear` 메소드 등으로 간편하게 관리할 수 있다.